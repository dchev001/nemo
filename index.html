<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- html info, default -->
    <meta charset="utf-8">
    <title>FIU Biscayne Bay</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1.0,user-scalable=no">
    
    <!-- css -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/mapLayer.css">
    <link rel="stylesheet" href="css/legend.css">
    
    <!-- mapbox -->
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.4.1/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.4.1/mapbox-gl.js"></script>   
    
    <!-- icons -->
    <script src="https://code.jquery.com/jquery-3.4.1.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"/>   
       
  </head>

  <body>
    <!-- menu container -->
    <div class="container">
      <div class="topnav">
        <a href="#" onclick="showDataLayers()"><i class="fas fa-layer-group"></i></a>    
        <a href="#" onclick="showMapSubMenu()"><i class="fas fa-map"></i></a>
      </div>
    </div>
 
    <!-- map -->

    <div id="map"></div>

    <!-- javascript -->
    <script src="javascript/main.js"></script>
     
    
    <!-- map console -->
    <div id="mapConsole">
      <div class="items">
        <a onclick="changeMap('satellite-v9')">Satellite</a>
        <a onclick="changeMap('light-v10')">Light</a>
        <a onclick="changeMap('dark-v10')">Dark</a>
        <a onclick="changeMap('streets-v11')">Streets</a>
        <a onclick="changeMap('outdoors-v11')">Outdoors</a>     
      </div>
    </div>


    <!-- Layer Console -->
    <div id="mapLegend">
      <!-- drop down list of the data -->
      <div class="dropDownList">
        <select name="dataLayers" id="dataLayer" onchange="changeLegend()">
          <option value="temp" selected>Temperature</option>
          <option value="pH_level">pH Level</option>
          <option value="odo">Dissolved Oxygen</option>
          <option value="salinity">Salinity</option>
          <option value="chlorophyll">Chlorophyll</option>
          <option value="turbidity">Turbidity</option>
        </select>
      </div>
      <!-- drop down list end -->     

      <!-- map legend -->
      <div class="gradContainer" id="gradNum">
      </div>
      <!-- map legend end -->

    </div>
    <!-- layer console end -->

    <!-- Data info console -->
    <div class='data-info'>
      <div><strong>Date:</strong> <span id='date_info'></span></div>
      <div><strong>Time:</strong> <span id='time_info'></span></div>
      <div><strong>Temp 째C:</strong> <span id='temp_info'></span></div>
      <div><strong>pH:</strong> <span id='ph_info'></span></div>
      <div><strong>odo:</strong> <span id='odo_info'></span></div>
      <div><strong>Turbidity:</strong> <span id='turbidity_info'></span></div>
      <div><strong>Salinity:</strong> <span id='salinity_info'></span></div>
      <div><strong>Chlorophyll:</strong> <span id='chlorophyll_info'></span></div>
    </div>
    <!-- Data info console end -->

<script>

map.on('load', () => {
  map.addSource('data_all', {
    'type' : 'geojson',
    'data' : './biscayne.geojson'
  });

  
  /* Layer for temp */
  map.addLayer({
    'id' : 'temp',
    'type' : 'circle',
    'source' : 'data_all',
    paint: {
      'circle-radius': [
        'step',
        ['get', 'Temp 째C'],
        5,
        30.0,
        6.5,
        31.0,
        8,
        32.0,
        9.5,
        33.0,
        10,
      ],
      'circle-stroke-width': [
        'case',
        ['boolean', ['feature-state', 'hover'], false],
        1,
        0.1
        ],
      'circle-stroke-color': '#000',
      'circle-color': [
        'step',
        ['get', 'Temp 째C'],
        'green',
        30.0,
        'red',
        31.0,
        'blue',
        32.0,
        'yellow',
        33.0,
        'purple',
      ],
      'circle-opacity': 0.7
    },        
  });

  let hoverStatus = null;

  map.on('mouseenter', 'temp', (e) => {
    map.getCanvas().style.cursor = 'pointer';
    
    const temp_val = e.features[0].properties["Temp 째C"];
    const ph_val = e.features[0].properties["pH"];
    const odo_val = e.features[0].properties["ODO mg/L"];
    const turbidity_val = e.features[0].properties["Turbidity FNU"];
    const salinity_val = e.features[0].properties["Sal psu"];
    const chlorophyll_val = e.features[0].properties["Chlorophyll ug/L"];
    const date_val = e.features[0].properties["Timestamp"];
  
    dt = new Date(date_val);
    months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
    full_months = months[dt.getMonth()];

    full_date = full_months + " " + dt.getDate() + ", " + dt.getFullYear();   
    
    if (dt.getHours() > 12 ? ampm = 'pm' : ampm = 'am');
    if (dt.getHours() > 12 ? hr = dt.getHours()-12 : hr = dt.getHours());
    if (hr <=9 ? hr = '0'+ hr : hr);
    if (dt.getMinutes() <= 9 ? mnt = '0' + dt.getMinutes() : mnt = dt.getMinutes()); 
    if (dt.getSeconds() <= 9 ? sec = '0' + dt.getSeconds() : sec = dt.getSeconds());
    
    full_time = hr + ":" + mnt + ":" + sec + " " + ampm;  

    //full_time = dt.getHours() + ":" + dt.getMinutes() + ":" + dt.getSeconds();

    document.getElementById("temp_info").innerHTML = temp_val;
    document.getElementById("time_info").innerHTML = full_time;
    document.getElementById("ph_info").innerHTML = ph_val;
    document.getElementById("odo_info").innerHTML = odo_val;
    document.getElementById("turbidity_info").innerHTML = turbidity_val;
    document.getElementById("salinity_info").innerHTML = salinity_val;
    document.getElementById("chlorophyll_info").innerHTML = chlorophyll_val;
    document.getElementById("date_info").innerHTML = full_date;
  });

  map.on('mouseleave', 'temp', () => {
    map.getCanvas().style.cursor = '';

    document.getElementById("temp_info").innerHTML = '';
    document.getElementById("time_info").innerHTML = '';
    document.getElementById("ph_info").innerHTML = '';
    document.getElementById("odo_info").innerHTML = '';
    document.getElementById("turbidity_info").innerHTML = '';
    document.getElementById("salinity_info").innerHTML = '';
    document.getElementById("chlorophyll_info").innerHTML = '';
    document.getElementById("date_info").innerHTML = '';
  });
});




</script>


  </body>
</html>